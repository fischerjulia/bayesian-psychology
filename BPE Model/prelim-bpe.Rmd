---
title: "Preliminary Bayesian Parameter Estimation Model"
author: "Julia Fischer"
date: "2023-10-04"
output:
  rmdformats::robobook:
    highlight: tango
  html_document:
    toc: true
    toc_depth: 4
    code_download: true
  word_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

TODO: write an introductory section
TODO: add commentary throughout to guide reader through the steps of the tutorial

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(brms)
library(tidyverse)
```

```{r person-level data}
# set filepath for data file
filepath <- "https://raw.githubusercontent.com/LRI-2/Data/main/ILD/AMIBshare_persons_2019_0501.csv"
# read in the .csv file using the url() function
AMIB_persons <- read.csv(file=url(filepath),header=TRUE)
```

```{r day-level data}
# set filepath for data file
filepath <- "https://raw.githubusercontent.com/LRI-2/Data/main/ILD/AMIBshare_daily_2019_0501.csv"
# read in the .csv file using the url() function
AMIB_daily <- read.csv(file=url(filepath),header=TRUE)
```

```{r interaction-level data}
# set filepath for data file
filepath <- "https://raw.githubusercontent.com/LRI-2/Data/main/ILD/AMIBshare_interaction_2019_0501.csv"
# read in the .csv file using the url() function
AMIB_interaction <- read.csv(file=url(filepath),header=TRUE)
```

```{r format data}
# subset to day-level variables of interest
bpe_daily <- AMIB_daily[,c("id", "day", "slphrs", "negaff")]
# subset to person-level variables of interest
bpe_persons <- AMIB_persons[,c("id", "erq_reap", "erq_supp")]
# merge day- and person-level data
bpe_data <- merge(bpe_daily, bpe_persons, by = "id")
```

```{r center predictor}
# center the erq subscale score variables for interpretability
bpe_data$erq_reap_c <- scale(bpe_data$erq_reap, center=TRUE,scale=FALSE)[,1]
bpe_data$erq_supp_c <- scale(bpe_data$erq_supp, center=TRUE,scale=FALSE)[,1]
```

```{r plot data}
#TODO: plot the raw data to get a sense for any trends in the data
      # correlation matrix
      # person-by-person plot
```

```{r bpe model reap}
bpe.reap <- brm(bf(negaff ~ b0 + b1 * day + b2 * slphrs + b3 * erq_reap_c + b4 * slphrs * erq_reap_c, b0 ~ 1 + (1|id), b1 ~ 1 + (1|id), b2 ~ 1 + (1|id), b3 ~ 1 + (1|id), b4 ~ 1 + (1|id), nl = TRUE), data = bpe_data, family = gaussian(), prior = c(
  prior(normal(0, 1), nlpar = "b0"),
  prior(normal(0, 1), nlpar = "b1"),
  prior(normal(0, 1), nlpar = "b2"),
  prior(normal(0, 1), nlpar = "b3"),
  prior(normal(0, 1), nlpar = "b4")),
  iter = 2000, chains = 4, cores = 4)
summary(bpe.reap)
bayes_R2(bpe.reap)
plot(bpe.reap)
```

TODO: interpret model results (including Bayesian significance testing)
TODO: make a visualization of this model that shows the prototypical individual and all individuals

```{r bpe model supp}
bpe.supp <- brm(bf(negaff ~ b0 + b1 * day + b2 * slphrs + b3 * erq_supp_c + b4 * slphrs * erq_supp_c, b0 ~ 1 + (1|id), b1 ~ 1 + (1|id), b2 ~ 1 + (1|id), b3 ~ 1 + (1|id), b4 ~ 1 + (1|id), nl = TRUE), data = bpe_data, family = gaussian(), prior = c(
  prior(normal(0, 1), nlpar = "b0"),
  prior(normal(0, 1), nlpar = "b1"),
  prior(normal(0, 1), nlpar = "b2"),
  prior(normal(0, 1), nlpar = "b3"),
  prior(normal(0, 1), nlpar = "b4")),
  iter = 2000, chains = 4, cores = 4)
summary(bpe.supp)
bayes_R2(bpe.supp)
plot(bpe.supp)
```

TODO: interpret model results (including Bayesian significance testing)
TODO: make a visualization of this model that shows the prototypical individual and all individuals

TODO: compare the two models (reap vs. supp - which one seems more predictive of better control of negaff?)

TODO: write up a final analysis/conclusion for this tutorial
